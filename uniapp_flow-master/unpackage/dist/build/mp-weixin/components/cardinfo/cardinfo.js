"use strict";const e=require("../../common/vendor.js"),t=require("../../common/Task.js"),s={name:"cardinfo",props:{taskIndex:Number,task:Object,colorid:Number,editable:Boolean,mode:String},created(){console.log("task is:",this.task)},computed:{Id(){return this.task.id},userName:{get(){return this.task.username},set(e){this.task.username=e}},taskType:{get(){return this.task.tag}},reward:{get(){return this.task.rewardtype===t.RewardType.Fiexd?this.task.fixedReward&&0!==this.task.fixedReward?this.task.fixedReward/100:"":this.task.percentReward&&0!==this.task.percentReward?this.task.percentReward/100:""},set(e){this.task.rewardtype===t.RewardType.Fiexd&&(this.task.fixedReward=isNaN(parseFloat(e))?0:parseInt(100*parseFloat(e))),this.task.rewardtype===t.RewardType.Percent&&(this.task.percentReward=isNaN(parseFloat(e))?0:parseInt(100*parseFloat(e)))}},rewardtype:{get(){return this.task.rewardtype},set(e){this.task.rewardtype=parseInt(e)}},rewardSymbol(){return this.task.rewardtype===t.RewardType.Fiexd?"￥":this.task.rewardtype===t.RewardType.Percent?"%":""},branch:{get(){return this.$store.getters.getBranch(this.task.branchid)}},depart(){let e;try{e=this.branchs[this.branchOrder]}catch(t){e="??"}return e},branchOrder:{get(){return this.branchIndex?this.branchIndex:this.$store.getters.getBranchIndex(this.task.branchid)},set(e){this.branchIndex=e}},branchs(){return this.$store.state.branchs},nullTask(){return null===this.task||void 0===this.task},deadline:{get(){try{let e=this.task.deadline.indexOf("T");if(-1!==e)return this.task.deadline.substring(0,e)}catch(e){}return this.task.deadline},set(e){this.task.deadline=e}},title:{get(){return this.task.title},set(e){this.task.title=e}},rewardtypeSymbol(){return{text:"%",options:[{text:"￥",value:"1",name:"固定",selected:!0,disable:this.taskType&&"only percent"===this.taskType.rewardType},{text:"%",value:"2",name:"百分比",disable:this.taskType&&"only fixed"===this.taskType.rewardType}]}}},methods:{branchChange(e){console.log("picker发送选择改变，携带值为",e);let t=e.detail.value;this.branchIndex=t,this.task.branchid=t},rewardTypeChange(e){console.log("rewardType 改变，携带值为",e),this.task.rewardtype=parseInt(e.value);let t=getCurrentPages(),s=t[t.length-1];s.mode&&"single"==s.mode?(this.task.percentReward=1e4,this.task.fixedReward=0):this.task.percentReward=""},detail(t){if(!this.editable)if(this.$store.state.$hasLogin){const t=getCurrentPages();let s=t[t.length-1];"taskDetail"!==s.route.split("/").at(-1)&&"myTaskDetail"!==s.route.split("/").at(-1)&&(this.$store.commit("setCurrentTask",this.task),this.$store.dispatch("genHistory",this.task.id),e.index.navigateTo({url:"/pages/taskDetail/taskDetail?id="+this.task.id}))}else e.index.navigateTo({url:"/pages/logintips/logintips"})},updateBrief(e){this.task.title=e.detail.value},updatePt(e){this.task.deadline=e.detail.value},updateDes(e){this.task.description=e},biupdatePt(e){console.log(e),this.task.deadline=e},check(){return console.log(this.task),this.task.title?this.task.tag?(this.task.rewardtype!==t.RewardType.Fiexd||this.task.fixedReward)&&(this.task.rewardtype!==t.RewardType.Percent||this.task.percentReward)?this.task.deadline?void this.$emit("check-Result",!0):(this.$emit("check-Result",!1),void e.index.showModal({content:"截止日期不能为空！"})):(this.$emit("check-Result",!1),void e.index.showModal({content:"回馈值不能为空！"})):(this.$emit("check-Result",!1),void e.index.showModal({content:"类型概括不能为空！"})):(this.$emit("check-Result",!1),void e.index.showModal({content:"标题不能为空！"}))},put(){if(console.log(this.task),!this.task.title)return e.index.showModal({content:"标题不能为空！"}),!1;if(this.task.rewardtype===t.RewardType.Fiexd&&!this.task.fixedReward)return e.index.showModal({content:"回馈值不能为空！"}),!1;if(this.task.rewardtype===t.RewardType.Percent&&!this.task.percentReward)return e.index.showModal({content:"回馈值不能为空！"}),!1;if(!this.task.deadline)return e.index.showModal({content:"截止日期不能为空！"}),!1;let s=this.$store.state.apiBaseUrl+"/api/Assignment/"+this.task.id;e.index.requestWithCookie({url:s,method:"PUT",data:this.task,success:e=>{204===e.statusCode?(this.$store.state.$publishResults.push({success:!0,message:"任务："+this.task.title+"修改成功",errMsg:"ok"}),this.$emit("after-publish",this.task.id)):this.$store.state.$publishResults.push({success:!1,message:"任务："+this.task.title+"修改失败",errMsg:"server error"})},fail:e=>{console.error(e),this.$store.state.$publishResults.push({success:!1,message:"任务："+this.task.title+"修改失败",errMsg:"client error"})}})},removeTask(t){console.log(t),1!==this.task.main?this.$emit("remove-task",this.task.id):e.index.showModal({title:"错误！",showCancel:!1,content:"主任务不能被移除。只能返回后重新创建新任务。"})},showPopup(e){console.log("click show"),this.vis=!0},exitDel(e){console.log("exit"),this.vis=!1}},data:()=>({vis:!1,status:["待接","待完成","完成","公示"],branchIndex:!1})};if(!Array){(e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-select"))()}Math||((()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js"))();const a=e._export_sfc(s,[["render",function(t,s,a,i,r,d){return e.e({a:e.n(`fontcolor${d.Id%3} poster`),b:e.t(d.Id),c:!a.editable,d:d.title,e:e.o(((...e)=>d.updateBrief&&d.updateBrief(...e))),f:e.n("fontcolor"+d.Id%3),g:e.t(d.deadline),h:e.o(d.biupdatePt),i:e.o((e=>d.deadline=e)),j:e.p({type:"datetime",modelValue:d.deadline}),k:e.n("fontcolor"+d.Id%3),l:!a.editable,m:d.reward,n:e.o((e=>d.reward=e.detail.value)),o:e.t(d.rewardSymbol),p:a.editable},a.editable?{q:e.o(d.rewardTypeChange),r:e.p({disabled:1===a.task.main,localdata:d.rewardtypeSymbol.options,clear:!1,modelValue:d.rewardtype,placeholder:"类型"})}:{},{s:a.editable},a.editable?{t:e.o(((...e)=>d.showPopup&&d.showPopup(...e)))}:{},{v:!a.editable,w:a.task.tag,x:e.o((e=>a.task.tag=e.detail.value)),y:e.t(d.branch),z:e.n("fontcolor"+d.Id%3),A:e.t(d.userName),B:e.n("fontcolor"+d.Id%3),C:e.s(a.editable?"display:none":"display:flex;flex-direction: column;"),D:e.t(r.status[a.task.status]),E:e.s(a.editable?"display:none":"display:flex"),F:r.vis},r.vis?{G:e.o(((...e)=>d.removeTask&&d.removeTask(...e))),H:e.o(((...e)=>d.exitDel&&d.exitDel(...e)))}:{},{I:e.n("task"+d.Id%3),J:e.o(((...e)=>d.detail&&d.detail(...e)))})}]]);wx.createComponent(a);
