"use strict";const t=require("../../common/vendor.js");require("../../common/storageKeys.js");const e={name:"taskCard",props:{task:{type:Object,default:()=>({id:!1,username:!1,branchid:1,description:"",finishtime:"0001-01-01T00:00:00",deadline:"",fixedReward:"",percentReward:"",publishtime:"0001-01-01T00:00:00",rewardtype:1,status:1,title:"",tag:"",verify:0,main:0})},editable:{type:Boolean,default:()=>!1},mode:{type:String,default:()=>"done"}},data:()=>({content:{}}),computed:{html:{get(){return void 0===this.content.html?(this.setContent(this.task.description),this.task.description):this.content.html},set(t){this.content=t,this.task.description=t.html}}},onLoad(t){console.log("options:",t),this.$data.task.branchid=t.branchid,console.log("branchid is ",this.$data.task.branchid)},methods:{editEvent(e){this.$store.commit("setEditContent",this.content),t.index.navigateTo({url:"/pages/editor/editor?id="+this.task.id})},setContent(t){this.content.html=t},updateT(e){console.log("updateT trigger",e);for(let s of e.files)e.ctx.delta.ops.indexOf((t=>t.attributes&&t.attributes["data-local"]===s.path)),t.index.uploadFileWithCookie({url:this.$store.state.apiBaseUrl+"/api/Image/upload",filePath:s.path,name:s.name,success:t=>{let i=JSON.parse(t.data);if((""+t.statusCode).startsWith("2")){let t='<img src="'+s.path+'" data-local="'+s.path+'" alt="图像">',a='<img src="'+this.$store.state.apiBaseUrl+"/flow/static/"+i.$values[0].url+'">';console.log(t,a);let o=e.ctx.html.replace(t,a);console.log(o),this.$refs.cardinfo.updateDes(o)}}});this.content=e.ctx},check(){return this.$refs.cardinfo.check()},checkResult(t){this.$emit("check-Result",t)},put(){return this.$refs.cardinfo.put()},afterPublish(t){this.$emit("after-publish",t)},removeTask(t){this.$emit("remove-task",t)}}};if(!Array){t.resolveComponent("cardinfo")()}Math;const s=t._export_sfc(e,[["render",function(e,s,i,a,o,n){return t.e({a:t.sr("cardinfo","0f887c44-0"),b:t.o(n.checkResult),c:t.o(n.removeTask),d:t.p({task:i.task,editable:i.editable,mode:i.mode}),e:n.html,f:i.editable},i.editable?{g:t.o(((...t)=>n.editEvent&&n.editEvent(...t)))}:{},{h:t.o(((...t)=>n.checkResult&&n.checkResult(...t)))})}]]);wx.createComponent(s);
