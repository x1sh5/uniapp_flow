"use strict";const t=require("../../common/vendor.js"),e={data:()=>({$enable:!1,task:{id:!1,username:!1,branchid:1,description:"任务描述",finishtime:"0001-01-01T00:00:00",deadline:"",publishtime:"0001-01-01T00:00:00",fixedReward:"",percentReward:"",rewardtype:1,status:1,title:"",tag:"",verify:0},mode:{type:String,default:()=>"done"},status:["waitfor","undone","done","announcement"]}),created(){this.task=this.$store.state.currentTask},computed:{enable(){return this.$data.$enable},html:{get(){return this.task.description}},balance(){return this.task.fixedReward/100}},onLoad(e){console.log("options:",e),this.id=e.id;let s=this.$store.getters.getTaskById(this.id);if(void 0!==s)this.task=s;else{let e=this.$store.state.apiBaseUrl+"/api/Assignment/"+this.id;t.index.requestWithCookie({url:e,success:t=>{200==t.statusCode&&(this.task=t.data)}})}this.mode=this.status[this.task.status]},methods:{edit(e){t.index.navigateTo({url:"/pages/editTask/editTask"})},del(e){let s=this.$store.state.apiBaseUrl+"/api/Assignment/delete/"+this.task.id;t.index.requestWithCookie({url:s,method:"DELETE",success:e=>{if(204===e.statusCode){t.index.showToast({title:"删除成功。"});const e=getCurrentPages();e[e.length-2].removeById(this.task.id),t.index.navigateBack()}404===e.statusCode&&t.index.showModal({content:"无效的任务。"}),409===e.statusCode&&t.index.showModal({content:"任务已被他人接取,请等待任务完成或被放弃。"})}})},pay(e){let s=this.$store.state.apiBaseUrl+"/api/Bill/pubPayV3",a=this.$store.state.apiBaseUrl+"/api/wechatpay/v3/notify/transactions";this.task&&this.task.id&&t.wx$1.login({success:e=>{e.code?t.index.request({url:s,method:"POST",data:{OutTradeNo:"1",Description:"任务"+this.task.id+"的固定预支付费用",Total:100*this.balance,JsCode:e.code,NotifyUrl:a,Attach:"taskid="+this.task.id},success:e=>{if(200===e.statusCode){let s=e.data;console.log(s),t.index.requestPayment({timeStamp:s.timeStamp,nonceStr:s.nonceStr,package:s.package,signType:"RSA",paySign:s.paySign,success:e=>{t.index.showToast({title:"支付成功"}),this.task.payed=1,this.$store.commit("updateLocalTaskById",this.task)},fail:t=>{}})}},fail:t=>{}}):console.log("登录失败！"+e.errMsg)}})}}};if(!Array){t.resolveComponent("cardinfo")()}Math;const s=t._export_sfc(e,[["render",function(e,s,a,i,o,d){return t.e({a:t.p({task:o.task,editable:!1}),b:d.html,c:"waitfor"==o.mode},"waitfor"==o.mode?{d:t.o(((...t)=>d.edit&&d.edit(...t))),e:t.o(((...t)=>d.del&&d.del(...t)))}:{},{f:"undone"==o.mode},(o.mode,{}),{g:"done"==o.mode},"done"==o.mode?{h:t.o(((...t)=>d.del&&d.del(...t)))}:{},{i:0==o.task.canTake&&1==o.task.main&&0==o.task.payed},0==o.task.canTake&&1==o.task.main&&0==o.task.payed?{j:t.t(d.balance),k:100*d.balance>0,l:t.o(((...t)=>d.pay&&d.pay(...t)))}:{})}]]);wx.createPage(s);
